#!/bin/bash

# ์์ ์ฝ๋ ๋ก๊ทธ์ธ ํ์คํธ ์คํฌ๋ฆฝํธ

BASE_URL="https://asia-northeast1-story-make-fbbd7.cloudfunctions.net"

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ ์์ ์ฝ๋ ๋ก๊ทธ์ธ ํ์คํธ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# 1. ํ์คํธ ์์ ์์ฑ
echo "๐ 1๋จ๊ณ: ํ์คํธ ์์ ์์ฑ ์ค..."
RESPONSE=$(curl -s -X POST "$BASE_URL/classCreate" \
  -H "Content-Type: application/json" \
  -d '{
    "className": "Story Maker ์ฒดํ ์์",
    "instructorName": "์ด์์๋",
    "instructorPin": "123456"
  }')

CLASS_CODE=$(echo "$RESPONSE" | grep -o '"classCode":"[^"]*"' | cut -d'"' -f4)

echo "โ ์์ ์์ฑ ์๋ฃ!"
echo "   ์์ ์ฝ๋: $CLASS_CODE"
echo ""

# 2. ํ์ ๋ก๊ทธ์ธ ํ์คํธ
echo "๐ค 2๋จ๊ณ: ํ์ ๋ก๊ทธ์ธ ํ์คํธ..."
LEARNER_RESPONSE=$(curl -s -X POST "$BASE_URL/learnerEnsure" \
  -H "Content-Type: application/json" \
  -d "{
    \"classCode\": \"$CLASS_CODE\",
    \"learnerCode\": \"0001\",
    \"learnerName\": \"ํ์คํธํ์1\"
  }")

LEARNER_ID=$(echo "$LEARNER_RESPONSE" | grep -o '"learnerId":"[^"]*"' | cut -d'"' -f4)

echo "โ ํ์ ๋ก๊ทธ์ธ ์ฑ๊ณต!"
echo "   ํ์ ID: $LEARNER_ID"
echo ""

# 3. ์ฑ์์ ์ฌ์ฉํ ์๋ณด
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ฏ ์ฑ์์ ์ฌ์ฉํ์ธ์:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ ์์ ์ฝ๋: $CLASS_CODE"
echo "๐ค ํ์ ๋ฒํธ: 0001"
echo "๐ ์ด๋ฆ: ํ์คํธํ์1"
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ฑ ๋ก๊ทธ์ธ ํ์ด์ง์์ ์ ์๋ณด๋ฅผ ์๋ฅํ์ธ์:"
echo "   https://3000-i5dcsscuqxml7neuit43a-de59bda9.sandbox.novita.ai"
echo ""

