<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Functions í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }

        .test-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }

        button:hover {
            background: #45a049;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 300px;
            overflow-y: auto;
        }

        .result.success {
            border-color: #4CAF50;
            background: #f1f8f4;
        }

        .result.error {
            border-color: #f44336;
            background: #fef1f0;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #fff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.6s linear infinite;
            margin-left: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .info-box {
            background: #e3f2fd;
            border: 1px solid #2196F3;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 30px;
        }

        .info-box strong {
            color: #1976D2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Firebase Functions í…ŒìŠ¤íŠ¸</h1>
        <p class="subtitle">ìˆ˜ì—… ìš´ì˜ ì‹œìŠ¤í…œ API í…ŒìŠ¤íŠ¸</p>

        <div class="info-box">
            <strong>ğŸ“ Base URL:</strong> https://asia-northeast1-story-make-fbbd7.cloudfunctions.net
        </div>

        <!-- Test 1: ìˆ˜ì—… ìƒì„± -->
        <div class="test-section">
            <h2>1ï¸âƒ£ ìˆ˜ì—… ìƒì„± (classCreate)</h2>
            <div class="input-group">
                <label>ìˆ˜ì—… ì´ë¦„:</label>
                <input type="text" id="className" value="í…ŒìŠ¤íŠ¸ ìˆ˜ì—…" />
            </div>
            <div class="input-group">
                <label>ê°•ì‚¬ ì´ë¦„:</label>
                <input type="text" id="instructorName" value="ê¹€ì„ ìƒ" />
            </div>
            <div class="input-group">
                <label>ê°•ì‚¬ PIN (6ìë¦¬):</label>
                <input type="text" id="instructorPin" value="123456" maxlength="6" />
            </div>
            <button onclick="testCreateClass()" id="btnCreateClass">ìˆ˜ì—… ìƒì„±</button>
            <div id="resultCreateClass" class="result" style="display:none"></div>
        </div>

        <!-- Test 2: PIN ê²€ì¦ -->
        <div class="test-section">
            <h2>2ï¸âƒ£ ê°•ì‚¬ PIN ê²€ì¦ (classVerifyPin)</h2>
            <div class="input-group">
                <label>ìˆ˜ì—… ì½”ë“œ:</label>
                <input type="text" id="classCodeVerify" placeholder="ABCD1234" />
            </div>
            <div class="input-group">
                <label>ê°•ì‚¬ PIN:</label>
                <input type="text" id="instructorPinVerify" value="123456" maxlength="6" />
            </div>
            <button onclick="testVerifyPin()" id="btnVerifyPin">PIN ê²€ì¦</button>
            <div id="resultVerifyPin" class="result" style="display:none"></div>
        </div>

        <!-- Test 3: í•™ìƒ ë¡œê·¸ì¸ -->
        <div class="test-section">
            <h2>3ï¸âƒ£ í•™ìƒ ë¡œê·¸ì¸ (learnerEnsure)</h2>
            <div class="input-group">
                <label>ìˆ˜ì—… ì½”ë“œ:</label>
                <input type="text" id="classCodeLearner" placeholder="ABCD1234" />
            </div>
            <div class="input-group">
                <label>í•™ìƒ ì½”ë“œ (4ìë¦¬):</label>
                <input type="text" id="learnerCode" value="0001" maxlength="4" />
            </div>
            <div class="input-group">
                <label>í•™ìƒ ì´ë¦„:</label>
                <input type="text" id="learnerName" value="ê¹€í•™ìƒ" />
            </div>
            <button onclick="testLearnerLogin()" id="btnLearnerLogin">í•™ìƒ ë¡œê·¸ì¸</button>
            <div id="resultLearnerLogin" class="result" style="display:none"></div>
        </div>

        <!-- Test 4: ì‘í’ˆ ì €ì¥ -->
        <div class="test-section">
            <h2>4ï¸âƒ£ ì‘í’ˆ ì €ì¥ (artifactSave)</h2>
            <div class="input-group">
                <label>í•™ìƒ ID:</label>
                <input type="text" id="learnerIdArtifact" placeholder="ABCD1234-0001" />
            </div>
            <div class="input-group">
                <label>ì‘í’ˆ ì œëª©:</label>
                <input type="text" id="artifactTitle" value="í…ŒìŠ¤íŠ¸ ì‘í’ˆ" />
            </div>
            <div class="input-group">
                <label>ì‘í’ˆ íƒ€ì…:</label>
                <select id="artifactType">
                    <option value="story">ê¸€ì“°ê¸°</option>
                    <option value="image">ì´ë¯¸ì§€</option>
                    <option value="storybook">ë™í™”ì±…</option>
                </select>
            </div>
            <button onclick="testSaveArtifact()" id="btnSaveArtifact">ì‘í’ˆ ì €ì¥</button>
            <div id="resultSaveArtifact" class="result" style="display:none"></div>
        </div>

        <!-- Test 5: ì‘í’ˆ ëª©ë¡ -->
        <div class="test-section">
            <h2>5ï¸âƒ£ ì‘í’ˆ ëª©ë¡ ì¡°íšŒ (artifactList)</h2>
            <div class="input-group">
                <label>í•™ìƒ ID:</label>
                <input type="text" id="learnerIdList" placeholder="ABCD1234-0001" />
            </div>
            <button onclick="testListArtifacts()" id="btnListArtifacts">ì‘í’ˆ ëª©ë¡ ì¡°íšŒ</button>
            <div id="resultListArtifacts" class="result" style="display:none"></div>
        </div>

        <!-- Test 6: ê³µìœ  IDë¡œ ì¡°íšŒ -->
        <div class="test-section">
            <h2>6ï¸âƒ£ ê³µìœ  ì‘í’ˆ ì¡°íšŒ (artifactByShare)</h2>
            <div class="input-group">
                <label>ê³µìœ  ID:</label>
                <input type="text" id="shareId" placeholder="Ab3dEf7Gh9Jk" />
            </div>
            <button onclick="testGetByShare()" id="btnGetByShare">ì‘í’ˆ ì¡°íšŒ</button>
            <div id="resultGetByShare" class="result" style="display:none"></div>
        </div>
    </div>

    <script>
        const BASE_URL = 'https://asia-northeast1-story-make-fbbd7.cloudfunctions.net';

        // ì‘ì€ í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ (1x1 ë¹¨ê°„ìƒ‰ í”½ì…€)
        const TEST_IMAGE = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8DwHwAFBQIAX8jx0gAAAABJRU5ErkJggg==';

        function showResult(elementId, data, success = true) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = success ? 'result success' : 'result error';
            element.textContent = JSON.stringify(data, null, 2);
        }

        function setLoading(buttonId, loading) {
            const button = document.getElementById(buttonId);
            button.disabled = loading;
            if (loading) {
                button.innerHTML += '<span class="loading"></span>';
            } else {
                const loadingSpan = button.querySelector('.loading');
                if (loadingSpan) loadingSpan.remove();
            }
        }

        async function testCreateClass() {
            const className = document.getElementById('className').value;
            const instructorName = document.getElementById('instructorName').value;
            const instructorPin = document.getElementById('instructorPin').value;

            setLoading('btnCreateClass', true);

            try {
                const response = await fetch(`${BASE_URL}/classCreate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ className, instructorName, instructorPin })
                });

                const data = await response.json();
                showResult('resultCreateClass', data, response.ok);

                if (data.classCode) {
                    document.getElementById('classCodeVerify').value = data.classCode;
                    document.getElementById('classCodeLearner').value = data.classCode;
                }
            } catch (error) {
                showResult('resultCreateClass', { error: error.message }, false);
            } finally {
                setLoading('btnCreateClass', false);
            }
        }

        async function testVerifyPin() {
            const classCode = document.getElementById('classCodeVerify').value;
            const instructorPin = document.getElementById('instructorPinVerify').value;

            setLoading('btnVerifyPin', true);

            try {
                const response = await fetch(`${BASE_URL}/classVerifyPin`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ classCode, instructorPin })
                });

                const data = await response.json();
                showResult('resultVerifyPin', data, response.ok);
            } catch (error) {
                showResult('resultVerifyPin', { error: error.message }, false);
            } finally {
                setLoading('btnVerifyPin', false);
            }
        }

        async function testLearnerLogin() {
            const classCode = document.getElementById('classCodeLearner').value;
            const learnerCode = document.getElementById('learnerCode').value;
            const learnerName = document.getElementById('learnerName').value;

            setLoading('btnLearnerLogin', true);

            try {
                const response = await fetch(`${BASE_URL}/learnerEnsure`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ classCode, learnerCode, learnerName })
                });

                const data = await response.json();
                showResult('resultLearnerLogin', data, response.ok);

                if (data.learnerId) {
                    document.getElementById('learnerIdArtifact').value = data.learnerId;
                    document.getElementById('learnerIdList').value = data.learnerId;
                }
            } catch (error) {
                showResult('resultLearnerLogin', { error: error.message }, false);
            } finally {
                setLoading('btnLearnerLogin', false);
            }
        }

        async function testSaveArtifact() {
            const learnerId = document.getElementById('learnerIdArtifact').value;
            const title = document.getElementById('artifactTitle').value;
            const type = document.getElementById('artifactType').value;

            setLoading('btnSaveArtifact', true);

            try {
                const response = await fetch(`${BASE_URL}/artifactSave`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        learnerId,
                        type,
                        title,
                        data: { content: 'í…ŒìŠ¤íŠ¸ ë‚´ìš©', timestamp: new Date().toISOString() },
                        files: { thumbnail: TEST_IMAGE }
                    })
                });

                const data = await response.json();
                showResult('resultSaveArtifact', data, response.ok);

                if (data.shareId) {
                    document.getElementById('shareId').value = data.shareId;
                }
            } catch (error) {
                showResult('resultSaveArtifact', { error: error.message }, false);
            } finally {
                setLoading('btnSaveArtifact', false);
            }
        }

        async function testListArtifacts() {
            const learnerId = document.getElementById('learnerIdList').value;

            setLoading('btnListArtifacts', true);

            try {
                const response = await fetch(`${BASE_URL}/artifactList?learnerId=${encodeURIComponent(learnerId)}`);
                const data = await response.json();
                showResult('resultListArtifacts', data, response.ok);
            } catch (error) {
                showResult('resultListArtifacts', { error: error.message }, false);
            } finally {
                setLoading('btnListArtifacts', false);
            }
        }

        async function testGetByShare() {
            const shareId = document.getElementById('shareId').value;

            setLoading('btnGetByShare', true);

            try {
                const response = await fetch(`${BASE_URL}/artifactByShare?shareId=${encodeURIComponent(shareId)}`);
                const data = await response.json();
                showResult('resultGetByShare', data, response.ok);
            } catch (error) {
                showResult('resultGetByShare', { error: error.message }, false);
            } finally {
                setLoading('btnGetByShare', false);
            }
        }
    </script>
</body>
</html>
